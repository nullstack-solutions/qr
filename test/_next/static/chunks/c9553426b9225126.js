(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67585,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"BailoutToCSR",{enumerable:!0,get:function(){return l}});let r=e.r(32061);function l({reason:e,children:t}){if("undefined"==typeof window)throw Object.defineProperty(new r.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},9885,(e,t,a)=>{"use strict";function r(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"encodeURIPath",{enumerable:!0,get:function(){return r}})},52157,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"PreloadChunks",{enumerable:!0,get:function(){return i}});let r=e.r(43476),l=e.r(74080),n=e.r(63599),s=e.r(9885);function i({moduleIds:e}){if("undefined"!=typeof window)return null;let t=n.workAsyncStorage.getStore();if(void 0===t)return null;let a=[];if(t.reactLoadableManifest&&e){let r=t.reactLoadableManifest;for(let t of e){if(!r[t])continue;let e=r[t].files;a.push(...e)}}return 0===a.length?null:(0,r.jsx)(r.Fragment,{children:a.map(e=>{let a=`${t.assetPrefix}/_next/${(0,s.encodeURIPath)(e)}`;return e.endsWith(".css")?(0,r.jsx)("link",{precedence:"dynamic",href:a,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,l.preload)(a,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69093,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"default",{enumerable:!0,get:function(){return d}});let r=e.r(43476),l=e.r(71645),n=e.r(67585),s=e.r(52157);function i(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},d=function(e){let t={...o,...e},a=(0,l.lazy)(()=>t.loader().then(i)),d=t.loading;function u(e){let i=d?(0,r.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,o=!t.ssr||!!t.loading,u=o?l.Suspense:l.Fragment,c=t.ssr?(0,r.jsxs)(r.Fragment,{children:["undefined"==typeof window?(0,r.jsx)(s.PreloadChunks,{moduleIds:t.modules}):null,(0,r.jsx)(a,{...e})]}):(0,r.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(a,{...e})});return(0,r.jsx)(u,{...o?{fallback:i}:{},children:c})}return u.displayName="LoadableComponent",u}},70703,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"default",{enumerable:!0,get:function(){return l}});let r=e.r(55682)._(e.r(69093));function l(e,t){let a={};"function"==typeof e&&(a.loader=e);let l={...a,...t};return(0,r.default)({...l,modules:l.loadableGenerated?.modules})}("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},44215,e=>{e.v({actionButtons:"Generator-module__Uisdya__actionButtons",badge:"Generator-module__Uisdya__badge",btn:"Generator-module__Uisdya__btn",btnPrimary:"Generator-module__Uisdya__btnPrimary",btnSecondary:"Generator-module__Uisdya__btnSecondary",checkboxRow:"Generator-module__Uisdya__checkboxRow",colorInput:"Generator-module__Uisdya__colorInput",colorPicker:"Generator-module__Uisdya__colorPicker",colorPickerGroup:"Generator-module__Uisdya__colorPickerGroup",colorPreview:"Generator-module__Uisdya__colorPreview",divider:"Generator-module__Uisdya__divider",fadeIn:"Generator-module__Uisdya__fadeIn",fadeInDown:"Generator-module__Uisdya__fadeInDown",fadeInUp:"Generator-module__Uisdya__fadeInUp",fieldControl:"Generator-module__Uisdya__fieldControl",fieldGrid:"Generator-module__Uisdya__fieldGrid",fieldTitle:"Generator-module__Uisdya__fieldTitle",generator:"Generator-module__Uisdya__generator",gradientBlock:"Generator-module__Uisdya__gradientBlock",gradientColorGroup:"Generator-module__Uisdya__gradientColorGroup",gradientColorItem:"Generator-module__Uisdya__gradientColorItem",gradientHeader:"Generator-module__Uisdya__gradientHeader",gradientName:"Generator-module__Uisdya__gradientName",gradientSection:"Generator-module__Uisdya__gradientSection",header:"Generator-module__Uisdya__header",headerSubtitle:"Generator-module__Uisdya__headerSubtitle",headerTitle:"Generator-module__Uisdya__headerTitle",infoCard:"Generator-module__Uisdya__infoCard",infoCardWarning:"Generator-module__Uisdya__infoCardWarning",input:"Generator-module__Uisdya__input",inputGroup:"Generator-module__Uisdya__inputGroup",inputLabel:"Generator-module__Uisdya__inputLabel",loading:"Generator-module__Uisdya__loading",loadingActive:"Generator-module__Uisdya__loadingActive",logoButtons:"Generator-module__Uisdya__logoButtons",logoControls:"Generator-module__Uisdya__logoControls",logoHint:"Generator-module__Uisdya__logoHint",logoPreview:"Generator-module__Uisdya__logoPreview",logoRemoveButton:"Generator-module__Uisdya__logoRemoveButton",logoUploadButton:"Generator-module__Uisdya__logoUploadButton",logoUploadInput:"Generator-module__Uisdya__logoUploadInput",qrCanvas:"Generator-module__Uisdya__qrCanvas",qrCode:"Generator-module__Uisdya__qrCode",qrPreview:"Generator-module__Uisdya__qrPreview",rangeControls:"Generator-module__Uisdya__rangeControls",rangeGroup:"Generator-module__Uisdya__rangeGroup",rangeHint:"Generator-module__Uisdya__rangeHint",rangeInput:"Generator-module__Uisdya__rangeInput",rangeNumber:"Generator-module__Uisdya__rangeNumber",rangeStepper:"Generator-module__Uisdya__rangeStepper",rangeValue:"Generator-module__Uisdya__rangeValue",rotate:"Generator-module__Uisdya__rotate",select:"Generator-module__Uisdya__select",slider:"Generator-module__Uisdya__slider",styleGrid:"Generator-module__Uisdya__styleGrid",styleLabel:"Generator-module__Uisdya__styleLabel",styleOption:"Generator-module__Uisdya__styleOption",styleOptionActive:"Generator-module__Uisdya__styleOptionActive",stylePreview:"Generator-module__Uisdya__stylePreview",switch:"Generator-module__Uisdya__switch",switchInput:"Generator-module__Uisdya__switchInput",tab:"Generator-module__Uisdya__tab",tabActive:"Generator-module__Uisdya__tabActive",tabContent:"Generator-module__Uisdya__tabContent",tabContentActive:"Generator-module__Uisdya__tabContentActive",tabs:"Generator-module__Uisdya__tabs",templateCard:"Generator-module__Uisdya__templateCard",templateCardActive:"Generator-module__Uisdya__templateCardActive",templateDesc:"Generator-module__Uisdya__templateDesc",templateGrid:"Generator-module__Uisdya__templateGrid",templateName:"Generator-module__Uisdya__templateName",textarea:"Generator-module__Uisdya__textarea"})},52683,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(70703),l=e.i(43794),n=e.i(17850);function s(e){let t="";for(let a=0;a<e.length;a+=32768)t+=String.fromCharCode(...e.subarray(a,a+32768));return t}var i=e.i(22709);let o=280,d=256,u=4096,c=1024,m=64,y=0,p=20,f=8,h=2;function g(e,t){return Math.max(0,Math.round(e*t/100))}var _=e.i(44215);let b="http://www.w3.org/2000/svg";function x(e){return!Number.isFinite(e)||e<0?0:e>.6?.6:e}function v(e,t){let a=1-x(t);e.querySelectorAll("rect").forEach(e=>{let t=Number(e.getAttribute("width")),r=Number(e.getAttribute("height"));if(!t||!r||t>40||r>40)return;let l=Number(e.getAttribute("x")),n=Number(e.getAttribute("y"));if(!Number.isFinite(l)||!Number.isFinite(n))return;let s=t*a,i=r*a,o=l+t/2-s/2,d=n+r/2-i/2;e.setAttribute("x",o.toFixed(3)),e.setAttribute("y",d.toFixed(3)),e.setAttribute("width",s.toFixed(3)),e.setAttribute("height",i.toFixed(3))})}function j(e){let t=1/0;return e.forEach(e=>{let a=Number(e.getAttribute("width")),r=Number(e.getAttribute("height"));!Number.isFinite(a)||!Number.isFinite(r)||a<=0||r<=0||(t=Math.min(t,a,r))}),Number.isFinite(t)?t:null}function N(e,t,a,r){let l=Number(t.getAttribute("width")),n=Number(t.getAttribute("height"));if(!l||!n)return;let s=Number(t.getAttribute("x")),i=Number(t.getAttribute("y"));if(!Number.isFinite(s)||!Number.isFinite(i))return;let o=s+l/2,d=i+n/2,u=Math.min(l,n)*r,c=e.ownerDocument.createElementNS(b,"path");c.setAttribute("d",a.renderPath(o-u/2,d-u/2,u));let m=t.getAttribute("fill");m&&c.setAttribute("fill",m),t.parentNode?.replaceChild(c,t)}let G=[{id:"heart",name:"Сердце",emoji:"❤️",renderPath:(e,t,a)=>{let r=e+a/2,l=t+a/2,n=a/4;return`M ${r} ${l+n}
              C ${r} ${l+n}, ${r-2*n} ${l-n}, ${r-2*n} ${l-2*n}
              A ${n} ${n} 0 0 1 ${r} ${l-n}
              A ${n} ${n} 0 0 1 ${r+2*n} ${l-2*n}
              C ${r+2*n} ${l-n}, ${r} ${l+n}, ${r} ${l+n} Z`}},{id:"star",name:"Звезда",emoji:"⭐",renderPath:(e,t,a)=>{let r=e+a/2,l=t+a/2,n=a/2,s=a/4,i=`M ${r} ${l-n}`;for(let e=0;e<5;e++){let t=(72*e-90)*Math.PI/180,a=(72*e-90+36)*Math.PI/180,o=r+s*Math.cos(a),d=l+s*Math.sin(a),u=r+n*Math.cos(t+2*Math.PI/5),c=l+n*Math.sin(t+2*Math.PI/5);i+=` L ${o} ${d} L ${u} ${c}`}return i+" Z"}},{id:"plus",name:"Плюс",emoji:"➕",renderPath:(e,t,a)=>{let r=a/3,l=e+a/2,n=t+a/2;return`M ${l-r/2} ${t}
              H ${l+r/2}
              V ${n-r/2}
              H ${e+a}
              V ${n+r/2}
              H ${l+r/2}
              V ${t+a}
              H ${l-r/2}
              V ${n+r/2}
              H ${e}
              V ${n-r/2}
              H ${l-r/2} Z`}},{id:"diamond",name:"Ромб",emoji:"💎",renderPath:(e,t,a)=>{let r=e+a/2,l=t+a/2;return`M ${r} ${t}
              L ${e+a} ${l}
              L ${r} ${t+a}
              L ${e} ${l} Z`}}];function S(e){return"string"==typeof e&&G.some(t=>t.id===e)}function C(e="medium"){window.Telegram?.WebApp&&window.Telegram.WebApp.HapticFeedback.impactOccurred(e)}function U(e,t){let a=x(Number(t.moduleSpacing??0)),r=t.customDotShape,l=t.customEyeInnerShape;S(r)?function(e,t,a,r={}){let l=G.find(e=>e.id===t);if(!l)return v(e,a);let n=1-x(a),s=Array.from(e.querySelectorAll("rect")),i=j(s),o=i?3*i:null,d=i?.2*i:null;s.forEach(t=>{let a=Number(t.getAttribute("width")),s=Number(t.getAttribute("height"));!a||!s||a>40||s>40||r.skipInnerEyes&&o&&d&&Math.abs(a-o)<=d&&Math.abs(s-o)<=d||N(e,t,l,n)})}(e,r,a,{skipInnerEyes:S(l)}):v(e,a),S(l)&&function(e,t){let a=G.find(e=>e.id===t);if(!a)return;let r=Array.from(e.querySelectorAll("rect"));if(!r.length)return;let l=j(r);if(!l)return;let n=3*l,s=.2*l;r.forEach(t=>{let r=Number(t.getAttribute("width")),l=Number(t.getAttribute("height"));!r||!l||Math.abs(r-n)>s||Math.abs(l-n)>s||N(e,t,a,1)})}(e,l),function(e,t){let a=e.querySelector("image");if(!a)return;if("circle"!==t.shape)return a.removeAttribute("clip-path");let r=Number(e.getAttribute("width"))||Number(t.width)||o,l=Number(e.getAttribute("height"))||Number(t.height)||o,n=Math.max(0,Math.min(r,l)/2-Number(t.margin??0)),s=e.querySelector("defs");s||(s=e.ownerDocument.createElementNS(b,"defs"),e.insertBefore(s,e.firstChild));let i="qr-logo-circle-mask",d=s.querySelector(`#${i}`);d||((d=e.ownerDocument.createElementNS(b,"clipPath")).setAttribute("id",i),s.appendChild(d));let u=d.querySelector("circle");u||(u=e.ownerDocument.createElementNS(b,"circle"),d.appendChild(u)),u.setAttribute("cx",(r/2).toFixed(3)),u.setAttribute("cy",(l/2).toFixed(3)),u.setAttribute("r",Math.max(n,0).toFixed(3)),a.setAttribute("clip-path",`url(#${i})`)}(e,t)}let w={exportSize:c,marginPercent:f,errorCorrection:"H",foreground:"#000000",background:"#ffffff",dotStyle:"rounded",eyeOuter:"square",eyeInner:"square",logoSize:18,shape:"square",dotSpacing:0,customDotShape:void 0,customEyeInnerShape:void 0,useDotsGradient:!1,dotsGradient:{type:"linear",rotation:0,colorStops:[{offset:0,color:"#0b1220"},{offset:1,color:"#4a5568"}]},useBackgroundGradient:!1,backgroundGradient:{type:"linear",rotation:0,colorStops:[{offset:0,color:"#ffffff"},{offset:1,color:"#f7fafc"}]},useCornersGradient:!1,cornersGradient:{type:"linear",rotation:0,colorStops:[{offset:0,color:"#0b1220"},{offset:1,color:"#4a5568"}]},hideBackgroundDots:!0},A=[{type:"url",emoji:"🌐",name:"URL",desc:"Ссылка на сайт"},{type:"text",emoji:"📄",name:"Текст",desc:"Произвольный текст"},{type:"tel",emoji:"📞",name:"Телефон",desc:"Звонок"},{type:"sms",emoji:"💬",name:"SMS",desc:"Сообщение"},{type:"mailto",emoji:"📧",name:"Email",desc:"Почта"},{type:"geo",emoji:"📍",name:"Геометка",desc:"Координаты"},{type:"wifi",emoji:"📶",name:"Wi-Fi",desc:"Подключение"},{type:"vcard",emoji:"👤",name:"vCard",desc:"Визитка"},{type:"mecard",emoji:"💳",name:"MeCard",desc:"Компакт визитка"},{type:"ics",emoji:"📅",name:"Событие",desc:"Календарь"}],$=[{id:"square",value:"square",label:"Квадраты",dotStyle:"square"},{id:"rounded",value:"rounded",label:"Скругленные",dotStyle:"rounded"},{id:"extra-rounded",value:"extra-rounded",label:"Очень скругленные",dotStyle:"extra-rounded"},{id:"dots",value:"dots",label:"Точки",dotStyle:"dots"},{id:"classy",value:"classy",label:"Classy",dotStyle:"classy"},{id:"classy-rounded",value:"classy-rounded",label:"Classy Rounded",dotStyle:"classy-rounded"},...G.map(e=>({id:`custom-dot-${e.id}`,value:`custom:${e.id}`,label:`${e.emoji} ${e.name}`,dotStyle:"square",customShape:e.id}))],P=[{value:"square",label:"Квадрат"},{value:"extra-rounded",label:"Скруглённый"},{value:"dot",label:"Точка"}],k=[{id:"square",value:"square",label:"Квадрат",eyeInner:"square"},{id:"dot",value:"dot",label:"Точка",eyeInner:"dot"},...G.map(e=>({id:`custom-eye-${e.id}`,value:`custom:${e.id}`,label:`${e.emoji} ${e.name}`,eyeInner:"square",customShape:e.id}))],M=[{value:"square",label:"Квадрат"},{value:"circle",label:"Круг"}];function I(){let{value:r,setValue:b,hydrated:x}=(0,i.useDraft)("generator",{type:"url",formValues:{},style:w}),v=(0,a.useMemo)(()=>{let e={...r.style};if(!e.exportSize&&e.size&&(e.exportSize=e.size,delete e.size),void 0===e.marginPercent&&void 0!==e.margin){let t=e.margin;e.marginPercent=Math.min(p,Math.max(y,2*t)),delete e.margin}return e.exportSize||(e.exportSize=c),void 0===e.marginPercent&&(e.marginPercent=f),{...r,style:e}},[r]),[j,N]=(0,a.useState)("content"),[G,S]=(0,a.useState)(""),[I,E]=(0,a.useState)({}),[O,q]=(0,a.useState)(0),[D,R]=(0,a.useState)(null),[B,L]=(0,a.useState)(!1),H=(0,a.useRef)(null),F=(0,a.useRef)(null),z=(0,a.useCallback)(()=>{let e=H.current;if(!e)return;e.style.width="100%",e.style.height="100%",e.style.maxWidth="100%",e.style.maxHeight="100%",e.style.display="grid",e.style.setProperty("place-items","center"),e.style.overflow="hidden",e.style.aspectRatio="1 / 1";let t=e.firstElementChild;t&&(t.style.width="100%",t.style.height="100%",t.style.maxWidth="100%",t.style.maxHeight="100%",t.style.display="grid",t.style.setProperty("place-items","center"),t.style.overflow="hidden",t.style.aspectRatio="1 / 1");let a=e.querySelector("svg");if(a){let e=Number(a.getAttribute("width"))||o,t=Number(a.getAttribute("height"))||o;!a.getAttribute("viewBox")&&e&&t&&a.setAttribute("viewBox",`0 0 ${e} ${t}`),a.removeAttribute("width"),a.removeAttribute("height"),a.setAttribute("preserveAspectRatio","xMidYMid meet"),a.style.width="100%",a.style.height="100%",a.style.maxWidth="100%",a.style.maxHeight="100%",a.style.display="block",a.style.margin="0 auto",a.style.objectFit="contain",a.style.setProperty("image-rendering","pixelated"),a.setAttribute("shape-rendering","crispEdges")}let r=e.querySelector("canvas");r&&(r.style.width="100%",r.style.height="100%",r.style.maxWidth="100%",r.style.maxHeight="100%",r.style.objectFit="contain",r.style.setProperty("image-rendering","pixelated"))},[]),T=(0,a.useCallback)(()=>{window.requestAnimationFrame(()=>{z()})},[z]),V=(0,a.useMemo)(()=>(0,n.getTypeDefinition)(v.type),[v.type]),Q=(0,a.useCallback)(e=>{b(t=>({...t,style:{...t.style,...e}}))},[b]),W=(0,a.useCallback)(e=>{Q({marginPercent:Math.min(p,Math.max(y,Math.round(e)))}),T()},[T,Q]),Z=(0,a.useCallback)(e=>{Q({exportSize:Math.min(u,Math.max(d,Math.round(e/m)*m))})},[Q]),K=(0,a.useCallback)((e,t)=>{b(a=>{var r;return{...a,formValues:{...a.formValues,[(r=a.type,`${r}.${e}`)]:t}}})},[b]),X=(0,a.useCallback)(e=>{C("light"),E({}),b(t=>({...t,type:e,formValues:t.formValues,style:t.style}))},[b]),Y=(0,a.useMemo)(()=>({L:15,M:20,Q:25,H:30})[v.style.errorCorrection]??30,[v.style.errorCorrection]);(0,a.useEffect)(()=>{void 0===v.style.dotSpacing&&Q({dotSpacing:w.dotSpacing})},[v.style.dotSpacing,Q]),(0,a.useEffect)(()=>{v.style.logoDataUrl&&v.style.logoSize>Y&&Q({logoSize:Y})},[v.style.logoDataUrl,v.style.logoSize,Y,Q]),(0,a.useEffect)(()=>{e.A(69579).then(e=>{R(()=>e.default)})},[]),(0,a.useEffect)(()=>{if(H.current&&D&&(F.current&&(H.current&&(H.current.innerHTML=""),F.current=null),!F.current)){let e=o,t=g(e,v.style.marginPercent),a=new D({type:"svg",width:e,height:e,data:"https://t.me/durov",image:void 0,margin:t,qrOptions:{errorCorrectionLevel:v.style.errorCorrection,mode:"Byte"},imageOptions:{hideBackgroundDots:v.style.hideBackgroundDots,imageSize:v.style.logoSize/100,margin:4,saveAsBlob:!0}});F.current=a,a.append(H.current),a.applyExtension(U),T()}},[D,v.style.errorCorrection,v.style.hideBackgroundDots,v.style.logoSize,v.style.marginPercent,T]);let J=(0,a.useMemo)(()=>{let e={};for(let r of V.fields){var t,a;let l=(t=v.type,a=r.name,`${t}.${a}`),n=v.formValues[l];void 0===n&&void 0!==r.prefill?e[r.name]=r.prefill:e[r.name]=n??""}return e},[v.formValues,v.type,V.fields]),ee=(0,a.useCallback)(()=>{if(!F.current)return!1;let e=V.buildPayload(J),t=new TextEncoder().encode(e),a=t.length;q(a);let r={};if(V.fields.forEach(e=>{let t=J[e.name]??"";if(e.required&&!t.trim()){r[e.name]="Обязательное поле";return}if(e.validate){let a=e.validate(t,J);a&&(r[e.name]=a)}e.pattern&&t&&!e.pattern.test(t)&&(r[e.name]="Некорректное значение")}),e||(r.__payload="Заполните обязательные поля"),a>2953&&(r.__payload=`Предел 2953 байт, сейчас ${a}`),E(r),Object.keys(r).length>0)return C("light"),!1;C("medium"),S(e);let l=o,n=g(l,v.style.marginPercent),i={type:"svg",data:s(t),width:l,height:l,image:v.style.logoDataUrl,shape:v.style.shape,margin:n,moduleSpacing:(v.style.dotSpacing??0)/100,customDotShape:v.style.customDotShape,customEyeInnerShape:v.style.customEyeInnerShape,qrOptions:{errorCorrectionLevel:v.style.errorCorrection,mode:"Byte"},dotsOptions:{...v.style.useDotsGradient&&v.style.dotsGradient?{gradient:v.style.dotsGradient}:{color:v.style.foreground},type:v.style.dotStyle},backgroundOptions:{...v.style.useBackgroundGradient&&v.style.backgroundGradient?{gradient:v.style.backgroundGradient}:{color:v.style.background}},cornersSquareOptions:{...v.style.useCornersGradient&&v.style.cornersGradient?{gradient:v.style.cornersGradient}:{color:v.style.foreground},type:v.style.eyeOuter},cornersDotOptions:{...v.style.useCornersGradient&&v.style.cornersGradient?{gradient:v.style.cornersGradient}:{color:v.style.foreground},type:v.style.eyeInner},imageOptions:{imageSize:v.style.logoSize/100,margin:4,hideBackgroundDots:v.style.hideBackgroundDots,saveAsBlob:!0}},d=()=>{F.current?.applyExtension((e,t)=>U(e,{...t,customDotShape:v.style.customDotShape,customEyeInnerShape:v.style.customEyeInnerShape})),T()},u=F.current?.update(i);return u&&"function"==typeof u.then?u.finally(d):d(),!0},[V,J,v.style,T]);(0,a.useEffect)(()=>{F.current&&ee()},[D,ee]),(0,a.useEffect)(()=>{!x||F.current&&ee()},[ee,x]),(0,a.useEffect)(()=>{T()},[v.style.marginPercent,T]);let et=(0,a.useCallback)(async e=>{if(F.current&&ee()){L(!0),C("heavy");try{let t=G||V.buildPayload(J),a=new TextEncoder().encode(t),r=v.style.exportSize,l=g(r,v.style.marginPercent),n={type:"svg",data:s(a),width:r,height:r,image:v.style.logoDataUrl,shape:v.style.shape,margin:l,moduleSpacing:(v.style.dotSpacing??0)/100,customDotShape:v.style.customDotShape,customEyeInnerShape:v.style.customEyeInnerShape,qrOptions:{errorCorrectionLevel:v.style.errorCorrection,mode:"Byte"},dotsOptions:{...v.style.useDotsGradient&&v.style.dotsGradient?{gradient:v.style.dotsGradient}:{color:v.style.foreground},type:v.style.dotStyle},backgroundOptions:{...v.style.useBackgroundGradient&&v.style.backgroundGradient?{gradient:v.style.backgroundGradient}:{color:v.style.background}},cornersSquareOptions:{...v.style.useCornersGradient&&v.style.cornersGradient?{gradient:v.style.cornersGradient}:{color:v.style.foreground},type:v.style.eyeOuter},cornersDotOptions:{...v.style.useCornersGradient&&v.style.cornersGradient?{gradient:v.style.cornersGradient}:{color:v.style.foreground},type:v.style.eyeInner},imageOptions:{imageSize:v.style.logoSize/100,margin:4,hideBackgroundDots:v.style.hideBackgroundDots,saveAsBlob:!0}},i=new D(n);i.applyExtension((e,t)=>U(e,{...t,customDotShape:v.style.customDotShape,customEyeInnerShape:v.style.customEyeInnerShape}));let o=await i.getRawData(e);if(!o)return;let d=t.slice(0,32).replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"").toLowerCase()||"qr",u=`${d}.${e}`,c=window.navigator;if(c&&"function"==typeof c.share&&"undefined"!=typeof File){let a="function"==typeof c.canShare,r=new File([o],u,{type:"svg"===e?"image/svg+xml":"image/png"});if(!a||c.canShare({files:[r]}))try{await c.share({files:[r],title:"QR код",text:t});return}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return}}let m=URL.createObjectURL(o);try{let e=document.createElement("a");e.href=m,e.download=u,document.body.appendChild(e),e.click(),document.body.removeChild(e)}finally{URL.revokeObjectURL(m)}}finally{L(!1)}}},[ee,G,V,J,v.style,D]);return(0,t.jsxs)("section",{className:_.default.generator,children:[(0,t.jsx)("div",{className:(0,l.default)(_.default.qrPreview,"preview"),children:(0,t.jsx)("div",{className:(0,l.default)(_.default.qrCode,"preview__canvas"),children:(0,t.jsx)("div",{ref:H,className:_.default.qrCanvas})})}),(0,t.jsxs)("div",{className:_.default.tabs,children:[(0,t.jsx)("button",{className:(0,l.default)(_.default.tab,{[_.default.tabActive]:"content"===j}),onClick:()=>{N("content"),C("light")},children:"📝 Контент"}),(0,t.jsx)("button",{className:(0,l.default)(_.default.tab,{[_.default.tabActive]:"style"===j}),onClick:()=>{N("style"),C("light")},children:"🎨 Стиль"}),(0,t.jsx)("button",{className:(0,l.default)(_.default.tab,{[_.default.tabActive]:"advanced"===j}),onClick:()=>{N("advanced"),C("light")},children:"⚙️ Продвинутые"})]}),(0,t.jsxs)("div",{className:(0,l.default)(_.default.tabContent,{[_.default.tabContentActive]:"content"===j}),children:[(0,t.jsxs)("div",{className:_.default.inputGroup,children:[(0,t.jsx)("label",{className:_.default.inputLabel,children:(0,t.jsx)("span",{children:"Выберите тип QR-кода"})}),(0,t.jsx)("div",{className:_.default.templateGrid,children:A.map(e=>(0,t.jsxs)("div",{"data-testid":`qr-template-${e.type}`,className:(0,l.default)(_.default.templateCard,{[_.default.templateCardActive]:v.type===e.type}),onClick:()=>X(e.type),children:[(0,t.jsxs)("div",{className:_.default.templateName,children:[e.emoji," ",e.name]}),(0,t.jsx)("div",{className:_.default.templateDesc,children:e.desc})]},e.type))})]}),(0,t.jsx)("div",{className:_.default.divider}),(0,t.jsxs)("div",{className:_.default.inputGroup,children:[(0,t.jsxs)("label",{className:_.default.inputLabel,children:[(0,t.jsx)("span",{children:V.title}),(0,t.jsx)("span",{className:_.default.badge,children:V.description})]}),V.fields.map(e=>{let a=`qr-input-${e.name}`;return(0,t.jsxs)("div",{className:_.default.inputGroup,children:[(0,t.jsx)("label",{className:_.default.inputLabel,htmlFor:a,children:(0,t.jsxs)("span",{children:[e.label,e.required&&" *"]})}),"textarea"===e.type?(0,t.jsx)("textarea",{id:a,name:e.name,"data-testid":`qr-input-${e.name}`,className:(0,l.default)(_.default.textarea,{error:!!I[e.name]}),value:J[e.name]??"",onChange:t=>K(e.name,t.target.value),placeholder:e.placeholder}):(0,t.jsx)("input",{id:a,name:e.name,"data-testid":`qr-input-${e.name}`,type:"email"===e.type?"email":"number"===e.type?"number":"text",className:(0,l.default)(_.default.input,{error:!!I[e.name]}),value:J[e.name]??"",onChange:t=>K(e.name,t.target.value),placeholder:e.placeholder}),e.helper&&(0,t.jsx)("small",{style:{fontSize:"12px",opacity:.6,marginTop:"4px"},children:e.helper}),I[e.name]&&(0,t.jsx)("span",{className:"error-text",children:I[e.name]})]},e.name)}),I.__payload&&(0,t.jsx)("span",{className:"error-text",children:I.__payload})]}),(0,t.jsxs)("div",{className:_.default.infoCard,children:["💡 ",(0,t.jsx)("strong",{children:"Совет:"})," Используйте короткие данные для лучшего сканирования QR-кода. Длина: ",O," / ",2953," байт"]})]}),(0,t.jsx)("div",{className:(0,l.default)(_.default.tabContent,{[_.default.tabContentActive]:"style"===j}),children:(0,t.jsxs)("div",{className:_.default.inputGroup,children:[(0,t.jsxs)("label",{className:_.default.inputLabel,children:[(0,t.jsx)("span",{children:"🧩 Геометрия"}),(0,t.jsx)("span",{className:_.default.badge,children:"Форма и глазки"})]}),(0,t.jsxs)("div",{className:_.default.fieldGrid,children:[(0,t.jsxs)("label",{className:_.default.fieldControl,children:[(0,t.jsx)("span",{className:_.default.fieldTitle,children:"Форма QR"}),(0,t.jsx)("select",{className:_.default.select,value:v.style.shape,onChange:e=>{Q({shape:e.target.value}),C("light")},children:M.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("label",{className:_.default.fieldControl,children:[(0,t.jsx)("span",{className:_.default.fieldTitle,children:"Стиль точек"}),(0,t.jsx)("select",{className:_.default.select,value:v.style.customDotShape?`custom:${v.style.customDotShape}`:v.style.dotStyle,onChange:e=>{let t=$.find(t=>t.value===e.target.value);t&&(Q({dotStyle:t.dotStyle,customDotShape:t.customShape}),C("light"))},children:$.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.id))})]}),(0,t.jsxs)("label",{className:_.default.fieldControl,children:[(0,t.jsx)("span",{className:_.default.fieldTitle,children:"Внешние глазки"}),(0,t.jsx)("select",{className:_.default.select,value:v.style.eyeOuter,onChange:e=>{Q({eyeOuter:e.target.value}),C("light")},children:P.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("label",{className:_.default.fieldControl,children:[(0,t.jsx)("span",{className:_.default.fieldTitle,children:"Внутренние глазки"}),(0,t.jsx)("select",{className:_.default.select,value:v.style.customEyeInnerShape?`custom:${v.style.customEyeInnerShape}`:v.style.eyeInner,onChange:e=>{let t=k.find(t=>t.value===e.target.value);t&&(Q({eyeInner:t.eyeInner,customEyeInnerShape:t.customShape}),C("light"))},children:k.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.id))})]})]}),(0,t.jsxs)("div",{className:_.default.rangeGroup,children:[(0,t.jsxs)("label",{className:_.default.inputLabel,children:[(0,t.jsx)("span",{children:"↔️ Расстояние между точками"}),(0,t.jsxs)("span",{className:_.default.rangeValue,children:[v.style.dotSpacing,"%"]})]}),(0,t.jsx)("input",{type:"range",className:_.default.rangeInput,min:0,max:60,step:5,value:v.style.dotSpacing??0,onChange:e=>{Q({dotSpacing:Number(e.target.value)}),C("light")}}),(0,t.jsx)("div",{className:_.default.rangeHint,children:"0% — плотная сетка, 60% — заметные промежутки."})]})]})}),(0,t.jsxs)("div",{className:(0,l.default)(_.default.tabContent,{[_.default.tabContentActive]:"advanced"===j}),children:[(0,t.jsxs)("div",{className:_.default.infoCard,children:["ℹ️ ",(0,t.jsx)("strong",{children:"Важно:"})," Размер экспорта не влияет на превью. Превью всегда оптимизировано для экрана устройства."]}),(0,t.jsxs)("div",{className:_.default.rangeGroup,children:[(0,t.jsxs)("label",{className:_.default.inputLabel,children:[(0,t.jsx)("span",{children:"📏 Размер экспорта (для скачивания)"}),(0,t.jsxs)("span",{className:_.default.rangeValue,children:[v.style.exportSize,"px"]})]}),(0,t.jsx)("input",{type:"range",className:_.default.rangeInput,min:d,max:u,step:m,value:v.style.exportSize,onChange:e=>Z(Number(e.target.value))}),(0,t.jsxs)("div",{className:_.default.rangeHint,children:["От ",d,"px (веб) до ",u,"px (печать, билборды)"]})]}),(0,t.jsxs)("div",{className:_.default.rangeGroup,children:[(0,t.jsxs)("label",{className:_.default.inputLabel,children:[(0,t.jsx)("span",{children:"🛡️ Уровень коррекции ошибок"}),(0,t.jsxs)("span",{className:_.default.rangeValue,children:["L"===v.style.errorCorrection&&"Низкий","M"===v.style.errorCorrection&&"Средний","Q"===v.style.errorCorrection&&"Высокий","H"===v.style.errorCorrection&&"Очень высокий"]})]}),(0,t.jsxs)("select",{className:_.default.select,value:v.style.errorCorrection,onChange:e=>Q({errorCorrection:e.target.value}),children:[(0,t.jsx)("option",{value:"L",children:"L — до 7%"}),(0,t.jsx)("option",{value:"M",children:"M — до 15%"}),(0,t.jsx)("option",{value:"Q",children:"Q — до 25%"}),(0,t.jsx)("option",{value:"H",children:"H — до 30%"})]}),(0,t.jsx)("div",{className:_.default.rangeHint,children:"Проценты показывают, какую часть QR-кода можно закрыть или испортить, чтобы он всё равно считывался."})]}),(0,t.jsxs)("div",{className:_.default.rangeGroup,children:[(0,t.jsxs)("label",{className:_.default.inputLabel,children:[(0,t.jsx)("span",{children:"🖼️ Отступ (Quiet Zone)"}),(0,t.jsxs)("span",{className:_.default.rangeValue,children:[v.style.marginPercent,"%"]})]}),(0,t.jsx)("input",{type:"range",className:_.default.rangeInput,min:y,max:p,step:h,value:v.style.marginPercent,onChange:e=>W(Number(e.target.value)),onInput:e=>W(Number(e.target.value))}),(0,t.jsxs)("div",{className:_.default.rangeControls,children:[(0,t.jsx)("button",{type:"button",className:_.default.rangeStepper,onClick:()=>W(v.style.marginPercent-h),"aria-label":"Уменьшить отступ",children:"−"}),(0,t.jsx)("input",{type:"number",className:_.default.rangeNumber,min:y,max:p,step:h,value:v.style.marginPercent,onChange:e=>W(Number(e.target.value))}),(0,t.jsx)("button",{type:"button",className:_.default.rangeStepper,onClick:()=>W(v.style.marginPercent+h),"aria-label":"Увеличить отступ",children:"+"})]}),(0,t.jsx)("div",{className:_.default.rangeHint,children:"В процентах от размера QR. 8% = стандарт, 0% = без отступа."})]}),(0,t.jsx)("div",{className:_.default.divider}),(0,t.jsxs)("div",{className:_.default.infoCard,children:["⚠️ ",(0,t.jsx)("strong",{children:"Внимание:"})," Высокий уровень коррекции ошибок делает QR-код более устойчивым к повреждениям, но увеличивает его сложность"]}),(0,t.jsxs)("div",{className:_.default.inputGroup,children:[(0,t.jsx)("label",{className:_.default.inputLabel,children:(0,t.jsx)("span",{children:"📦 Формат экспорта"})}),(0,t.jsxs)("select",{className:_.default.select,children:[(0,t.jsx)("option",{value:"png",children:"PNG (Рекомендуется)"}),(0,t.jsx)("option",{value:"svg",children:"SVG (Векторный)"})]})]})]}),(0,t.jsxs)("div",{className:(0,l.default)(_.default.actionButtons,"preview__actions"),children:[(0,t.jsx)("button",{className:(0,l.default)(_.default.btn,_.default.btnSecondary),onClick:()=>{ee(),C("medium")},children:"👁️ Превью"}),(0,t.jsx)("button",{className:(0,l.default)(_.default.btn,_.default.btnPrimary),onClick:()=>et("png"),children:"⬇️ Скачать QR"})]}),B&&(0,t.jsx)("div",{className:(0,l.default)(_.default.loading,_.default.loadingActive),children:"⏳ Генерация QR-кода..."})]})}function E(){return(0,t.jsx)("div",{className:"skeleton",children:(0,t.jsx)("div",{className:"skeleton-pulse"})})}function O(e="medium"){window.Telegram?.WebApp&&window.Telegram.WebApp.HapticFeedback.impactOccurred(e)}let q=(0,r.default)(()=>e.A(35064).then(e=>({default:e.BatchGenerator})),{loadableGenerated:{modules:[28505]},loading:()=>(0,t.jsx)(E,{}),ssr:!1}),D=(0,r.default)(()=>e.A(49191).then(e=>({default:e.Scanner})),{loadableGenerated:{modules:[72692]},loading:()=>(0,t.jsx)(E,{}),ssr:!1});function R(){let[e,r]=(0,a.useState)("generator");return(0,t.jsxs)("main",{className:"page",children:[(0,t.jsxs)("div",{className:_.default.header,children:[(0,t.jsx)("h1",{className:_.default.headerTitle,children:"QR Suite"}),(0,t.jsx)("p",{className:_.default.headerSubtitle,children:"Генератор, пакетная сборка и сканер QR-кодов"})]}),(0,t.jsxs)("div",{className:_.default.tabs,children:[(0,t.jsx)("button",{className:(0,l.default)(_.default.tab,{[_.default.tabActive]:"generator"===e}),onClick:()=>{r("generator"),O("light")},children:"🎨 Генератор"}),(0,t.jsx)("button",{className:(0,l.default)(_.default.tab,{[_.default.tabActive]:"batch"===e}),onClick:()=>{r("batch"),O("light")},children:"📦 Пакетная"}),(0,t.jsx)("button",{className:(0,l.default)(_.default.tab,{[_.default.tabActive]:"scanner"===e}),onClick:()=>{r("scanner"),O("light")},children:"📷 Сканер"})]}),"generator"===e&&(0,t.jsx)(I,{}),"batch"===e&&(0,t.jsx)(q,{}),"scanner"===e&&(0,t.jsx)(D,{}),(0,t.jsx)("footer",{className:"page__footer",children:(0,t.jsxs)("p",{children:["Черновики хранятся локально. Поддерживается CSV поле ",(0,t.jsx)("code",{children:"slug"})," для будущей миграции на динамические ссылки."]})})]})}e.s(["default",()=>R],52683)}]);