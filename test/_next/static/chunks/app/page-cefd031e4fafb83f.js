(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{67:function(){},2061:function(){},149:function(e,l,t){Promise.resolve().then(t.t.bind(t,5683,23)),Promise.resolve().then(t.bind(t,4570)),Promise.resolve().then(t.bind(t,1243)),Promise.resolve().then(t.bind(t,996))},4570:function(e,l,t){"use strict";t.r(l),t.d(l,{BatchGenerator:function(){return x}});var a=t(3827),n=t(4090),r=t(6491),s=t.n(r),i=t(4323),o=t(6480),c=t.n(o),d=t(4113),u=t(8058);let p={format:"png",size:600,errorCorrection:"H",margin:4,foreground:"#0b1220",background:"#ffffff",chunk:250};function h(e){return e.toString().trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,40)||"entry"}async function m(e){return new Promise((l,t)=>{s().parse(e,{header:!0,skipEmptyLines:!0,dynamicTyping:!1,complete:e=>{l(e.data.filter(Boolean))},error:t})})}async function v(e){let l=await e.arrayBuffer(),t=(0,i.ij)(l,{type:"array"}),a=t.Sheets[t.SheetNames[0]];return i.P6.sheet_to_json(a,{raw:!1,defval:""})}function x(){let e=(0,n.useRef)(null),[l,r]=(0,n.useState)([]),[s,i]=(0,n.useState)(null),[o,x]=(0,n.useState)(null),[g,f]=(0,n.useState)(null),[y,j]=(0,n.useState)(null),{value:b,setValue:N}=(0,u.L)("batch",p);(0,n.useEffect)(()=>{let l=new Worker(t.tu(new URL(t.p+t.u(194),t.b)));return e.current=l,l.onmessage=e=>{let l=e.data;if(l.error){f(l.error),x(null);return}if(void 0!==l.progress&&x({processed:l.processed,total:l.total,progress:l.progress}),l.done){let e=new Blob([l.buffer],{type:"application/zip"}),t=URL.createObjectURL(e);j(e=>(e&&URL.revokeObjectURL(e),t)),x(null)}},()=>{l.terminate()}},[]),(0,n.useEffect)(()=>()=>{y&&URL.revokeObjectURL(y)},[y]);let C=(0,n.useCallback)(async e=>{f(null),j(null),x(null),i(e.name);let l=[];try{l=e.name.toLowerCase().endsWith(".csv")?await m(e):await v(e)}catch(e){var t;f(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"Не удалось прочитать файл"),r([]);return}r(l.map((e,l)=>{var t,a,n,r,s,i;let o=(null!==(a=null!==(t=e.type)&&void 0!==t?t:e.Type)&&void 0!==a?a:"text").toString().trim().toLowerCase(),c=d.u.some(e=>e.type===o)?o:null,u=[],p="";if(c){let l=(0,d.x)(c),t={};for(let a of l.fields){let l=null!==(s=null!==(r=null!==(n=e[a.name])&&void 0!==n?n:e[a.name.toUpperCase()])&&void 0!==r?r:e[a.label])&&void 0!==s?s:"";if(t[a.name]=null!==(i=null==l?void 0:l.toString())&&void 0!==i?i:"",a.required&&!t[a.name].trim()&&u.push("Поле ".concat(a.label," обязательно")),a.validate){let e=a.validate(t[a.name],t);e&&u.push("".concat(a.label,": ").concat(e))}}(p=l.buildPayload(t))||u.push("Не удалось построить полезную нагрузку"),new TextEncoder().encode(p).length>2953&&u.push("Превышен лимит байт")}else u.push("Неизвестный тип: ".concat(e.type));let m=e.slug||e.SLUG||e.filename||e.name||Object.values(e)[1]||"row-".concat(l+1),v=h(null!=m?m:"row-".concat(l+1));return{index:l+1,type:c,slug:v,payload:p,errors:u,raw:e}}))},[]),S=(0,n.useMemo)(()=>l.slice(0,20),[l]),_=(0,n.useMemo)(()=>l.filter(e=>0===e.errors.length&&e.type),[l]),w=(0,n.useCallback)(()=>{if(!e.current)return;if(0===_.length){f("Нет валидных строк для генерации");return}let l=crypto.randomUUID();e.current.postMessage({id:l,items:_.map(e=>({index:e.index,type:e.type,payload:e.payload,slug:e.slug})),format:b.format,options:{errorCorrection:b.errorCorrection,margin:b.margin,size:b.size,foreground:b.foreground,background:b.background,chunk:b.chunk}}),x({processed:0,total:_.length,progress:0})},[b,_]),E=(0,n.useCallback)(()=>{if(!y)return;let e=document.createElement("a");e.href=y;let l=new Date().toISOString().slice(0,10),t=s?h(s.replace(/\.[^.]+$/,"")):"qr-batch";e.download="".concat(t,"-").concat(l,".zip"),document.body.appendChild(e),e.click(),document.body.removeChild(e)},[y,s]),k=(0,n.useCallback)(e=>{N(l=>({...l,...e}))},[N]);return(0,a.jsxs)("section",{className:"card",children:[(0,a.jsxs)("header",{className:"card__header",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{children:"Массовая генерация"}),(0,a.jsx)("p",{children:"Импорт CSV/XLSX, предпросмотр и ZIP c PNG/SVG."})]}),(0,a.jsxs)("span",{className:"badge",children:["10k строк, чанки ",b.chunk]})]}),(0,a.jsxs)("div",{className:"batch",children:[(0,a.jsxs)("div",{className:"batch__left",children:[(0,a.jsxs)("label",{className:"dropzone",children:[(0,a.jsx)("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:e=>{var l;let t=null===(l=e.target.files)||void 0===l?void 0:l[0];t&&C(t)}}),(0,a.jsx)("strong",{children:"Загрузите CSV или XLSX"}),(0,a.jsx)("span",{children:"Столбцы: type, поля формы, slug (опционально)"}),s?(0,a.jsx)("em",{children:s}):null]}),(0,a.jsxs)("div",{className:"batch__options",children:[(0,a.jsxs)("label",{children:["Формат",(0,a.jsxs)("select",{value:b.format,onChange:e=>k({format:e.target.value}),children:[(0,a.jsx)("option",{value:"png",children:"PNG"}),(0,a.jsx)("option",{value:"svg",children:"SVG"})]})]}),(0,a.jsxs)("label",{children:["Размер",(0,a.jsx)("input",{type:"number",min:256,max:1024,value:b.size,onChange:e=>k({size:Number(e.target.value)})})]}),(0,a.jsxs)("label",{children:["Коррекция",(0,a.jsxs)("select",{value:b.errorCorrection,onChange:e=>k({errorCorrection:e.target.value}),children:[(0,a.jsx)("option",{value:"L",children:"L"}),(0,a.jsx)("option",{value:"M",children:"M"}),(0,a.jsx)("option",{value:"Q",children:"Q"}),(0,a.jsx)("option",{value:"H",children:"H"})]})]}),(0,a.jsxs)("label",{children:["Отступ (модули)",(0,a.jsx)("input",{type:"number",min:0,max:8,value:b.margin,onChange:e=>k({margin:Number(e.target.value)})})]}),(0,a.jsxs)("label",{children:["Цвет точек",(0,a.jsx)("input",{type:"color",value:b.foreground,onChange:e=>k({foreground:e.target.value})})]}),(0,a.jsxs)("label",{children:["Цвет фона",(0,a.jsx)("input",{type:"color",value:b.background,onChange:e=>k({background:e.target.value})})]}),(0,a.jsxs)("label",{children:["Размер чанка",(0,a.jsx)("input",{type:"number",min:50,max:1e3,value:b.chunk,onChange:e=>k({chunk:Number(e.target.value)})})]})]}),(0,a.jsxs)("button",{type:"button",className:"primary",onClick:w,disabled:null!==o,children:["Сформировать ZIP (",_.length,")"]}),o?(0,a.jsxs)("p",{className:"progress",children:["Обработано ",o.processed,"/",o.total," (",Math.round(100*o.progress),"%)"]}):null,y?(0,a.jsx)("button",{type:"button",className:"secondary",onClick:E,children:"Скачать ZIP"}):null,g?(0,a.jsx)("p",{className:"error-text",children:g}):null]}),(0,a.jsxs)("div",{className:"batch__preview",children:[(0,a.jsxs)("h3",{children:["Предпросмотр первых ",S.length," строк"]}),0===S.length?(0,a.jsx)("p",{className:"hint",children:"Загрузите файл чтобы увидеть содержимое"}):(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"#"}),(0,a.jsx)("th",{children:"Тип"}),(0,a.jsx)("th",{children:"Slug"}),(0,a.jsx)("th",{children:"Ошибки"})]})}),(0,a.jsx)("tbody",{children:S.map(e=>{var l;return(0,a.jsxs)("tr",{className:c()({error:e.errors.length>0}),children:[(0,a.jsx)("td",{children:e.index}),(0,a.jsx)("td",{children:null!==(l=e.type)&&void 0!==l?l:e.raw.type}),(0,a.jsx)("td",{children:e.slug}),(0,a.jsx)("td",{children:e.errors.length>0?e.errors.join(", "):(0,a.jsx)("span",{className:"ok",children:"Готово"})})]},e.index)})})]})]})]})]})}},1243:function(e,l,t){"use strict";t.r(l),t.d(l,{Generator:function(){return u}});var a=t(3827),n=t(4090),r=t(6480),s=t.n(r),i=t(4113),o=t(8058);let c={size:320,errorCorrection:"H",foreground:"#0b1220",background:"#ffffff",margin:12,dotStyle:"rounded",eyeOuter:"square",eyeInner:"square",logoSize:18};function d(e,l){return"".concat(e,".").concat(l)}function u(){let{value:e,setValue:l,hydrated:r}=(0,o.L)("generator",{type:"url",formValues:{},style:c}),[u,p]=(0,n.useState)(""),[h,m]=(0,n.useState)({}),[v,x]=(0,n.useState)(0),[g,f]=(0,n.useState)(null),y=(0,n.useRef)(null),j=(0,n.useRef)(),b=(0,n.useMemo)(()=>(0,i.x)(e.type),[e.type]),N=(0,n.useCallback)(e=>{l(l=>({...l,style:{...l.style,...e}}))},[l]),C=(0,n.useCallback)((e,t)=>{l(l=>({...l,formValues:{...l.formValues,[d(l.type,e)]:t}}))},[l]),S=(0,n.useCallback)(e=>{m({}),l(l=>({...l,type:e,formValues:l.formValues,style:l.style}))},[l]);(0,n.useEffect)(()=>{Promise.all([t.e(587),t.e(620)]).then(t.t.bind(t,5439,23)).then(e=>{f(()=>e.default)})},[]),(0,n.useEffect)(()=>{if(y.current&&g&&!j.current){let e=new g({width:c.size,height:c.size,data:"https://example.com",image:void 0});j.current=e,e.append(y.current)}},[g]);let _=(0,n.useMemo)(()=>{let l={};for(let a of b.fields){var t;let n=d(e.type,a.name);l[a.name]=null!==(t=e.formValues[n])&&void 0!==t?t:""}return l},[e.formValues,e.type,b.fields]),w=(0,n.useCallback)(()=>{var l;if(!j.current)return!1;let t=b.buildPayload(_),a=new TextEncoder().encode(t).length;x(a);let n={};if(b.fields.forEach(e=>{var l;let t=null!==(l=_[e.name])&&void 0!==l?l:"";if(e.required&&!t.trim()){n[e.name]="Обязательное поле";return}if(e.validate){let l=e.validate(t,_);l&&(n[e.name]=l)}e.pattern&&t&&!e.pattern.test(t)&&(n[e.name]="Некорректное значение")}),t||(n.__payload="Заполните обязательные поля"),a>2953&&(n.__payload="Предел ".concat(2953," байт, сейчас ").concat(a)),m(n),Object.keys(n).length>0)return!1;p(t);let r={data:t,width:e.style.size,height:e.style.size,image:e.style.logoDataUrl,qrOptions:{errorCorrectionLevel:e.style.errorCorrection,margin:e.style.margin},dotsOptions:{color:e.style.foreground,type:e.style.dotStyle},backgroundOptions:{color:e.style.background},cornersSquareOptions:{color:e.style.foreground,type:e.style.eyeOuter},cornersDotOptions:{color:e.style.foreground,type:e.style.eyeInner},imageOptions:{imageSize:e.style.logoSize/100,margin:4}};return null===(l=j.current)||void 0===l||l.update(r),!0},[b,_,e.style]);(0,n.useEffect)(()=>{j.current&&w()},[g,w]),(0,n.useEffect)(()=>{r&&j.current&&w()},[w,r]);let E=(0,n.useCallback)(e=>{if(!e){N({logoDataUrl:void 0});return}if(!e.type.startsWith("image/"))return;let l=new FileReader;l.onload=()=>{N({logoDataUrl:l.result})},l.readAsDataURL(e)},[N]),k=(0,n.useCallback)(async e=>{if(!j.current||!w())return;let l=u||b.buildPayload(_),t=await j.current.getRawData(e);if(!t)return;let a=URL.createObjectURL(t),n=document.createElement("a"),r=l.slice(0,32).replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"").toLowerCase()||"qr";n.href=a,n.download="".concat(r,".").concat(e),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)},[w,u,h]);return(0,a.jsxs)("section",{className:"card",children:[(0,a.jsxs)("header",{className:"card__header",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{children:"Этап A. Генерация QR"}),(0,a.jsx)("p",{children:"Статические QR-коды всех типов с настройкой дизайна."})]}),(0,a.jsx)("span",{className:"badge",children:"Автосохранение в браузере"})]}),(0,a.jsx)("div",{className:"type-grid",children:i.u.map(l=>(0,a.jsxs)("button",{className:s()("pill",{pill__active:l.type===e.type}),onClick:()=>S(l.type),children:[(0,a.jsx)("strong",{children:l.title}),(0,a.jsx)("span",{children:l.description})]},l.type))}),(0,a.jsxs)("div",{className:"grid",children:[(0,a.jsxs)("div",{className:"grid__column",children:[(0,a.jsx)("h2",{children:"Данные"}),(0,a.jsxs)("form",{className:"form",onSubmit:e=>{e.preventDefault(),w()},children:[b.fields.map(e=>{var l,t;return(0,a.jsxs)("label",{className:"form__field",children:[(0,a.jsx)("span",{children:e.label}),"textarea"===e.type?(0,a.jsx)("textarea",{value:null!==(l=_[e.name])&&void 0!==l?l:"",onChange:l=>C(e.name,l.target.value),placeholder:e.placeholder,className:s()({error:!!h[e.name]})}):(0,a.jsx)("input",{type:"email"===e.type?"email":"text",value:null!==(t=_[e.name])&&void 0!==t?t:"",onChange:l=>C(e.name,l.target.value),placeholder:e.placeholder,className:s()({error:!!h[e.name]})}),e.helper?(0,a.jsx)("small",{children:e.helper}):null,h[e.name]?(0,a.jsx)("span",{className:"error-text",children:h[e.name]}):null]},e.name)}),(0,a.jsxs)("div",{className:"form__foot",children:[(0,a.jsxs)("span",{children:["Длина: ",v," байт из ",2953]}),h.__payload?(0,a.jsx)("span",{className:"error-text",children:h.__payload}):null]}),(0,a.jsx)("button",{type:"submit",className:"primary",children:"Собрать QR"})]})]}),(0,a.jsxs)("div",{className:"grid__column",children:[(0,a.jsx)("h2",{children:"Настройки стиля"}),(0,a.jsxs)("div",{className:"panel",children:[(0,a.jsxs)("label",{className:"panel__field",children:[(0,a.jsx)("span",{children:"Размер, px"}),(0,a.jsx)("input",{type:"range",min:240,max:520,value:e.style.size,onChange:e=>N({size:Number(e.target.value)})}),(0,a.jsx)("strong",{children:e.style.size})]}),(0,a.jsxs)("label",{className:"panel__field",children:[(0,a.jsx)("span",{children:"Коррекция ошибок"}),(0,a.jsxs)("select",{value:e.style.errorCorrection,onChange:e=>N({errorCorrection:e.target.value}),children:[(0,a.jsx)("option",{value:"L",children:"L — до 7%"}),(0,a.jsx)("option",{value:"M",children:"M — до 15%"}),(0,a.jsx)("option",{value:"Q",children:"Q — до 25%"}),(0,a.jsx)("option",{value:"H",children:"H — до 30%"})]})]}),(0,a.jsxs)("label",{className:"panel__field",children:[(0,a.jsx)("span",{children:"Цвет точек"}),(0,a.jsx)("input",{type:"color",value:e.style.foreground,onChange:e=>N({foreground:e.target.value})})]}),(0,a.jsxs)("label",{className:"panel__field",children:[(0,a.jsx)("span",{children:"Цвет фона"}),(0,a.jsx)("input",{type:"color",value:e.style.background,onChange:e=>N({background:e.target.value})})]}),(0,a.jsxs)("label",{className:"panel__field",children:[(0,a.jsx)("span",{children:"Стиль точек"}),(0,a.jsxs)("select",{value:e.style.dotStyle,onChange:e=>N({dotStyle:e.target.value}),children:[(0,a.jsx)("option",{value:"square",children:"Квадрат"}),(0,a.jsx)("option",{value:"rounded",children:"Скруглённый"}),(0,a.jsx)("option",{value:"dots",children:"Точки"}),(0,a.jsx)("option",{value:"classy",children:"Classy"}),(0,a.jsx)("option",{value:"classy-rounded",children:"Classy Rounded"})]})]}),(0,a.jsxs)("label",{className:"panel__field",children:[(0,a.jsx)("span",{children:"Внешние глазки"}),(0,a.jsxs)("select",{value:e.style.eyeOuter,onChange:e=>N({eyeOuter:e.target.value}),children:[(0,a.jsx)("option",{value:"square",children:"Квадрат"}),(0,a.jsx)("option",{value:"circle",children:"Круг"})]})]}),(0,a.jsxs)("label",{className:"panel__field",children:[(0,a.jsx)("span",{children:"Внутренние глазки"}),(0,a.jsxs)("select",{value:e.style.eyeInner,onChange:e=>N({eyeInner:e.target.value}),children:[(0,a.jsx)("option",{value:"square",children:"Квадрат"}),(0,a.jsx)("option",{value:"dot",children:"Точка"})]})]}),(0,a.jsxs)("label",{className:"panel__field",children:[(0,a.jsx)("span",{children:"Логотип"}),(0,a.jsx)("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml",onChange:e=>{var l,t;return E(null!==(t=null===(l=e.target.files)||void 0===l?void 0:l[0])&&void 0!==t?t:null)}}),e.style.logoDataUrl?(0,a.jsxs)("div",{className:"panel__thumb",children:[(0,a.jsx)("img",{src:e.style.logoDataUrl,alt:"Логотип"}),(0,a.jsx)("button",{type:"button",onClick:()=>E(null),className:"text",children:"Удалить"})]}):null]}),e.style.logoDataUrl?(0,a.jsxs)("label",{className:"panel__field",children:[(0,a.jsx)("span",{children:"Размер логотипа, %"}),(0,a.jsx)("input",{type:"range",min:10,max:30,value:e.style.logoSize,onChange:e=>N({logoSize:Number(e.target.value)})}),(0,a.jsx)("strong",{children:e.style.logoSize})]}):null]}),(0,a.jsxs)("div",{className:"preview","aria-live":"polite",children:[(0,a.jsx)("div",{ref:y,className:"preview__canvas"}),(0,a.jsxs)("div",{className:"preview__actions",children:[(0,a.jsx)("button",{type:"button",onClick:()=>k("png"),className:"primary",children:"Скачать PNG"}),(0,a.jsx)("button",{type:"button",onClick:()=>k("svg"),className:"secondary",children:"Скачать SVG"})]})]})]})]})]})}},996:function(e,l,t){"use strict";t.r(l),t.d(l,{Scanner:function(){return s}});var a=t(3827),n=t(4090),r=t(1735);function s(){let e=(0,n.useRef)(null),[l,t]=(0,n.useState)(!1),[s,i]=(0,n.useState)([]),[o,c]=(0,n.useState)(null),d=(0,n.useRef)(null);(0,n.useEffect)(()=>(e.current=new r.VJ,()=>{}),[]);let u=(0,n.useCallback)(async()=>{var l,a,n;if(e.current&&d.current){c(null);try{let n=await r.VJ.listVideoInputDevices(),s=null!==(a=null===(l=n[0])||void 0===l?void 0:l.deviceId)&&void 0!==a?a:void 0;t(!0),await e.current.decodeFromVideoDevice(s,d.current,(e,l)=>{if(e&&i(l=>[{text:e.getText(),timestamp:Date.now(),source:"camera"},...l].slice(0,20)),l&&"NotFoundException"!==l.name){var t;c(null!==(t=l.message)&&void 0!==t?t:"Ошибка сканирования")}})}catch(e){c(null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"Не удалось получить доступ к камере"),t(!1)}}},[]),p=(0,n.useCallback)(()=>{var e;(null===(e=d.current)||void 0===e?void 0:e.srcObject)&&d.current.srcObject.getTracks().forEach(e=>e.stop()),d.current&&(d.current.srcObject=null),t(!1)},[]),h=(0,n.useCallback)(async l=>{if(!e.current)return;c(null);let t=URL.createObjectURL(l);try{let l=await e.current.decodeFromImageUrl(t);i(e=>[{text:l.getText(),timestamp:Date.now(),source:"file"},...e].slice(0,20))}catch(e){var a;c(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:"Файл не содержит QR-код")}finally{URL.revokeObjectURL(t)}},[]);return(0,a.jsxs)("section",{className:"card",children:[(0,a.jsx)("header",{className:"card__header",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{children:"Клиентский сканер"}),(0,a.jsx)("p",{children:"Камера или изображение, всё локально."})]})}),(0,a.jsxs)("div",{className:"scanner",children:[(0,a.jsxs)("div",{className:"scanner__video",children:[(0,a.jsx)("video",{ref:d,playsInline:!0,muted:!0,autoPlay:!0,className:l?"active":""}),(0,a.jsxs)("div",{className:"scanner__controls",children:[l?(0,a.jsx)("button",{type:"button",onClick:p,className:"secondary",children:"Остановить"}):(0,a.jsx)("button",{type:"button",onClick:u,className:"primary",children:"Включить камеру"}),(0,a.jsxs)("label",{className:"upload",children:[(0,a.jsx)("input",{type:"file",accept:"image/png,image/jpeg,image/webp,image/svg+xml",onChange:e=>{var l;let t=null===(l=e.target.files)||void 0===l?void 0:l[0];t&&h(t)}}),(0,a.jsx)("span",{children:"Загрузить изображение"})]})]}),o?(0,a.jsx)("p",{className:"error-text",children:o}):null]}),(0,a.jsxs)("div",{className:"scanner__results",children:[(0,a.jsx)("h3",{children:"Последние результаты"}),0===s.length?(0,a.jsx)("p",{className:"hint",children:"Пока нет данных"}):(0,a.jsx)("ul",{children:s.map(e=>(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"pill pill__small",children:"camera"===e.source?"\uD83D\uDCF7":"\uD83D\uDDBC️"}),(0,a.jsx)("code",{children:e.text}),(0,a.jsx)("small",{children:new Date(e.timestamp).toLocaleTimeString()})]},e.timestamp+e.text))})]})]})]})}},8058:function(e,l,t){"use strict";t.d(l,{L:function(){return d}});var a=t(4090),n=t(3056);let r="drafts";async function s(){return(0,n.X3)("qr-suite",1,{upgrade(e){e.objectStoreNames.contains(r)||e.createObjectStore(r)}})}async function i(e){var l;let t=await s();return null!==(l=await t.get(r,e))&&void 0!==l?l:null}async function o(e,l){let t=await s();await t.put(r,l,e)}async function c(e){let l=await s();await l.delete(r,e)}function d(e,l){let[t,n]=(0,a.useState)(l),[r,s]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let l=!0;return i(e).then(e=>{l&&e&&n(e),l&&s(!0)}),()=>{l=!1}},[e]),(0,a.useEffect)(()=>{r&&o(e,t).catch(e=>{console.warn("Не удалось сохранить черновик",e)})},[e,t,r]);let d=async()=>{n(l),await c(e)};return{value:t,setValue:n,hydrated:r,reset:d}}},4113:function(e,l,t){"use strict";t.d(l,{u:function(){return s},x:function(){return i}});let a=[{type:"url",title:"URL",description:"Автодобавление схемы и базовая валидация",fields:[{name:"url",label:"Ссылка",placeholder:"example.com/page",required:!0,validate:e=>{let l=e.trim();if(!l)return"Укажите ссылку";let t=l.startsWith("http")?l:"https://".concat(l);try{if(!new URL(t).hostname.includes("."))return"Укажите корректный домен"}catch(e){return"Некорректный URL"}return null}}],buildPayload:e=>{var l,t;let a=null!==(t=null===(l=e.url)||void 0===l?void 0:l.trim())&&void 0!==t?t:"";return a?a.startsWith("http")?a:"https://".concat(a):""}},{type:"text",title:"Текст",description:"Любой UTF-8 текст",fields:[{name:"text",label:"Текст",type:"textarea",placeholder:"Введите текст",required:!0}],buildPayload:e=>{var l;return null!==(l=e.text)&&void 0!==l?l:""}},{type:"tel",title:"Телефон",description:"tap-to-call",fields:[{name:"phone",label:"Номер",placeholder:"+7 900 000-00-00",required:!0,validate:e=>{let l=e.replace(/[^\d+]/g,"");return/^\+?[\d]{5,15}$/.test(l)?null:"Введите телефон в формате +79991234567"}}],buildPayload:e=>{var l,t;return"tel:".concat(null!==(t=null===(l=e.phone)||void 0===l?void 0:l.replace(/[^\d+]/g,""))&&void 0!==t?t:"")}},{type:"sms",title:"SMS",description:"SMSTO: номер и текст",fields:[{name:"phone",label:"Номер",required:!0,placeholder:"+79001234567"},{name:"message",label:"Сообщение",type:"textarea",placeholder:"Текст SMS"}],buildPayload:e=>{var l,t,a;let n=null!==(t=null===(l=e.phone)||void 0===l?void 0:l.replace(/[^\d+]/g,""))&&void 0!==t?t:"",r=encodeURIComponent(null!==(a=e.message)&&void 0!==a?a:"");return"SMSTO:".concat(n,":").concat(r)}},{type:"mailto",title:"Email",description:"mailto: адрес, тема, тело",fields:[{name:"address",label:"Email",type:"email",required:!0},{name:"subject",label:"Тема"},{name:"body",label:"Сообщение",type:"textarea"}],buildPayload:e=>{var l;let t=new URLSearchParams;e.subject&&t.set("subject",e.subject),e.body&&t.set("body",e.body);let a=t.toString();return"mailto:".concat(null!==(l=e.address)&&void 0!==l?l:"").concat(a?"?".concat(a):"")}},{type:"geo",title:"Геометка",description:"Координаты lat,lng",fields:[{name:"lat",label:"Широта",required:!0,helper:"Напр. 59.9386"},{name:"lng",label:"Долгота",required:!0,helper:"Напр. 30.3141"},{name:"label",label:"Описание"}],buildPayload:e=>{var l,t;let a=null===(l=e.lat)||void 0===l?void 0:l.trim(),n=null===(t=e.lng)||void 0===t?void 0:t.trim();if(!a||!n)return"";let r=e.label?"?q=".concat(encodeURIComponent(e.label)):"";return"geo:".concat(a,",").concat(n).concat(r)}},{type:"wifi",title:"Wi-Fi",description:"SSID, тип, пароль",fields:[{name:"ssid",label:"SSID",required:!0},{name:"auth",label:"Шифрование",placeholder:"WPA, WPA2, WEP или nopass",helper:"nopass для открытых сетей"},{name:"password",label:"Пароль"},{name:"hidden",label:"Скрытая сеть (true/false)",placeholder:"false"}],buildPayload:e=>{var l,t,a,r;let s=null!==(a=e.ssid)&&void 0!==a?a:"",i=(null===(l=e.auth)||void 0===l?void 0:l.toUpperCase())||"WPA",o=null!==(r=e.password)&&void 0!==r?r:"",c=(null===(t=e.hidden)||void 0===t?void 0:t.toLowerCase())==="true"?";H:true":"";return"WIFI:T:".concat(i,";S:").concat(n(s),";P:").concat(n(o)).concat(c,";;")}},{type:"vcard",title:"vCard",description:"Контакты vCard 3.0",fields:[{name:"firstName",label:"Имя",required:!0},{name:"lastName",label:"Фамилия"},{name:"organization",label:"Компания"},{name:"title",label:"Должность"},{name:"phone",label:"Телефон"},{name:"email",label:"Email"},{name:"website",label:"Сайт"},{name:"notes",label:"Заметки",type:"textarea"}],buildPayload:e=>{var l,t;let a=["BEGIN:VCARD","VERSION:3.0","N:".concat(null!==(l=e.lastName)&&void 0!==l?l:"",";").concat(null!==(t=e.firstName)&&void 0!==t?t:"",";;;"),"FN:".concat([e.firstName,e.lastName].filter(Boolean).join(" "))];return e.organization&&a.push("ORG:".concat(e.organization)),e.title&&a.push("TITLE:".concat(e.title)),e.phone&&a.push("TEL;TYPE=CELL:".concat(e.phone)),e.email&&a.push("EMAIL;TYPE=INTERNET:".concat(e.email)),e.website&&a.push("URL:".concat(e.website)),e.notes&&a.push("NOTE:".concat(e.notes)),a.push("END:VCARD"),a.join("\n")}},{type:"mecard",title:"MeCard",description:"Компактный формат визитки",fields:[{name:"name",label:"Имя",required:!0},{name:"phone",label:"Телефон"},{name:"email",label:"Email"},{name:"address",label:"Адрес",type:"textarea"},{name:"note",label:"Заметка",type:"textarea"}],buildPayload:e=>{var l;let t=["MECARD:N:".concat(null!==(l=e.name)&&void 0!==l?l:"",";")];return e.phone&&t.push("TEL:".concat(e.phone,";")),e.email&&t.push("EMAIL:".concat(e.email,";")),e.address&&t.push("ADR:".concat(e.address,";")),e.note&&t.push("NOTE:".concat(e.note,";")),t.push(";"),t.join("")}},{type:"ics",title:"Событие ICS",description:"iCalendar (VEVENT)",fields:[{name:"summary",label:"Заголовок",required:!0},{name:"description",label:"Описание",type:"textarea"},{name:"location",label:"Место"},{name:"start",label:"Начало (ISO 8601)",placeholder:"2024-03-12T10:00"},{name:"end",label:"Конец (ISO 8601)",placeholder:"2024-03-12T12:00"}],buildPayload:e=>{let l=["BEGIN:VCALENDAR","VERSION:2.0","BEGIN:VEVENT"];return e.summary&&l.push("SUMMARY:".concat(e.summary)),e.description&&l.push("DESCRIPTION:".concat(e.description)),e.location&&l.push("LOCATION:".concat(e.location)),e.start&&l.push("DTSTART:".concat(r(e.start))),e.end&&l.push("DTEND:".concat(r(e.end))),l.push("END:VEVENT","END:VCALENDAR"),l.join("\n")}}];function n(e){return e.replace(/([\\;",:])/g,"\\$1")}function r(e){try{let l=new Date(e);if(Number.isNaN(l.getTime()))return e;return l.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}catch(l){return e}}let s=a;function i(e){return function(e){let l=a.find(l=>l.type===e);if(!l)throw Error("Unsupported QR type: ".concat(e));return l}(e)}},5683:function(){}},function(e){e.O(0,[425,790,971,69,744],function(){return e(e.s=149)}),_N_E=e.O()}]);