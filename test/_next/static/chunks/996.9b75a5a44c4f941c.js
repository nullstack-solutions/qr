"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[996],{996:function(e,l,s){s.r(l),s.d(l,{Scanner:function(){return n}});var a=s(3827),c=s(4090),t=s(1735);function n(){let e=(0,c.useRef)(null),[l,s]=(0,c.useState)(!1),[n,r]=(0,c.useState)([]),[i,u]=(0,c.useState)(null),d=(0,c.useRef)(null);(0,c.useEffect)(()=>(e.current=new t.VJ,()=>{}),[]);let o=(0,c.useCallback)(async()=>{var l,a,c;if(e.current&&d.current){u(null);try{let c=await t.VJ.listVideoInputDevices(),n=null!==(a=null===(l=c[0])||void 0===l?void 0:l.deviceId)&&void 0!==a?a:void 0;s(!0),await e.current.decodeFromVideoDevice(n,d.current,(e,l)=>{if(e&&r(l=>[{text:e.getText(),timestamp:Date.now(),source:"camera"},...l].slice(0,20)),l&&"NotFoundException"!==l.name){var s;u(null!==(s=l.message)&&void 0!==s?s:"Ошибка сканирования")}})}catch(e){u(null!==(c=null==e?void 0:e.message)&&void 0!==c?c:"Не удалось получить доступ к камере"),s(!1)}}},[]),m=(0,c.useCallback)(()=>{var e;(null===(e=d.current)||void 0===e?void 0:e.srcObject)&&d.current.srcObject.getTracks().forEach(e=>e.stop()),d.current&&(d.current.srcObject=null),s(!1)},[]),h=(0,c.useCallback)(async l=>{if(!e.current)return;u(null);let s=URL.createObjectURL(l);try{let l=await e.current.decodeFromImageUrl(s);r(e=>[{text:l.getText(),timestamp:Date.now(),source:"file"},...e].slice(0,20))}catch(e){var a;u(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:"Файл не содержит QR-код")}finally{URL.revokeObjectURL(s)}},[]);return(0,a.jsxs)("section",{className:"card",children:[(0,a.jsx)("header",{className:"card__header",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{children:"Клиентский сканер"}),(0,a.jsx)("p",{children:"Камера или изображение, всё локально."})]})}),(0,a.jsxs)("div",{className:"scanner",children:[(0,a.jsxs)("div",{className:"scanner__video",children:[(0,a.jsx)("video",{ref:d,playsInline:!0,muted:!0,autoPlay:!0,className:l?"active":""}),(0,a.jsxs)("div",{className:"scanner__controls",children:[l?(0,a.jsx)("button",{type:"button",onClick:m,className:"secondary",children:"Остановить"}):(0,a.jsx)("button",{type:"button",onClick:o,className:"primary",children:"Включить камеру"}),(0,a.jsxs)("label",{className:"upload",children:[(0,a.jsx)("input",{type:"file",accept:"image/png,image/jpeg,image/webp,image/svg+xml",onChange:e=>{var l;let s=null===(l=e.target.files)||void 0===l?void 0:l[0];s&&h(s)}}),(0,a.jsx)("span",{children:"Загрузить изображение"})]})]}),i?(0,a.jsx)("p",{className:"error-text",children:i}):null]}),(0,a.jsxs)("div",{className:"scanner__results",children:[(0,a.jsx)("h3",{children:"Последние результаты"}),0===n.length?(0,a.jsx)("p",{className:"hint",children:"Пока нет данных"}):(0,a.jsx)("ul",{children:n.map(e=>(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"pill pill__small",children:"camera"===e.source?"\uD83D\uDCF7":"\uD83D\uDDBC️"}),(0,a.jsx)("code",{children:e.text}),(0,a.jsx)("small",{children:new Date(e.timestamp).toLocaleTimeString()})]},e.timestamp+e.text))})]})]})]})}}}]);